---
title: "Tabset Row"
runtime: shiny
output: 
  flexdashboard::flex_dashboard:
    orientation: columns

---

```{r setup, include=FALSE}
library(flexdashboard)
library(readr)
library(lubridate)
library(shiny)
library(jsonlite)
library(maptools)
library(ggplot2)
library(tidyr)
library(dplyr)
library(purrr)
library(leaflet)
library(plotly)
library(DT)
library(ggthemes)
library(viridis)
library(table1)
ipf_lifts <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-10-08/ipf_lifts.csv") %>% mutate(sex2 = if_else(sex == "F", "Female", "Male")) %>% 
filter(division != "NA")
```

```{r}
## Removing non-SBD competitors and creating total three variable

SBD_IPF <- ipf_lifts %>% 
  filter(event == "SBD")
  

lifts <- SBD_IPF %>%
  rowwise() %>%
  mutate(total_three = sum(c(best3squat_kg, best3bench_kg, best3deadlift_kg), na.rm = TRUE))
```

Column {.sidebar}
-----------------------------------------------------------------------

### I didn't choose The powerlifting life 
    
blalalalalalalalalalalalalablalalalalalala
lalalalalalablalalalalalalalalalalal
alablalalalalalalalalalalalalablalal
alalalalalalalalalalablalalalalalalalalala
lalalablalalalalalalalalalalalalablala
lalalalalalalalalalalablalalalalalalalal

### Data Filtering

```{r overall filter, echo=FALSE }
#sex options
selectizeInput('division_select', 'Select Division:',
            choices = c("All", ipf_lifts$division %>% unique()), selected="All", multiple = T)



overall.subset <- reactive({
    if (input$division_select=="All") {
      ipf_lifts
    }else{
      ipf_lifts %>% filter(division == input$division_select)
    }
  })

#age options

selectInput('meet_select', 'Select Meets:',
                choices = c("All", (ipf_lifts$meet_name) %>% unique()),
                selected =  "All", multiple = T )


 overall.subset2 <- reactive({
    if (input$meet_select== "All") {
    overall.subset()
    }else{
   overall.subset() %>% filter(meet_name == input$meet_select)
    }
  })


 filtered <- reactive({
   overall.subset2()
 })
 
```


Column {.tabset}
-------------------------------------

### Age and Weight Lifted

```{r}
lifts %>% 
  ggplot(aes(x = age_class, total_three))
```   
 
### Sex and Weight Lifted
    
```{r}
sex_lifting <- lifts %>%
  ggplot(aes(x = date, y = total_three, color = sex)) + 
  geom_line() +
  facet_wrap(~sex)
sex_lifting

ggplotly(sex_lifting)
```

### Table

```{r interactive, echo=FALSE }
#sex options
selectInput('sex_select', 'Select sex:',
            choices = c("All", ipf_lifts$sex2 %>% unique()), selected="All", multiple = T )

dt.subset <- reactive({
    if (input$sex_select=="All") {
      filtered()
    }else{
      filtered() %>% filter(sex2 == input$sex_select)
    }
  })

#age options

selectInput('ageclass_select', 'Select Age Class:', 
                choices = c("All", (ipf_lifts$age_class) %>% unique()), 
                selected =  "All", multiple = T  )


 dt.subset2 <- reactive({
    if (input$ageclass_select== "All") {
    dt.subset()
    }else{
   dt.subset() %>% filter(age_class == input$ageclass_select)
    }
  })

# renderUI({
#     selectInput('weightclass_select', 'Select Weight Class:', 
#                 choices = c("All", (dt.subset2()$weight_class_kg ) %>% unique()), 
#                 selected =  "All" )
#   })

     selectInput('weightclass_select', 'Select Weight Class:', 
                choices = c("All", (ipf_lifts$weight_class_kg ) %>% unique()), 
                selected =  "All", multiple = T )

 
   dt.subset3 <- reactive({
    if (input$weightclass_select=="All") {
      dt.subset2()
    }else{
      dt.subset2() %>% filter(weight_class_kg == input$weightclass_select)
    }
  })
   
   renderDataTable(dt.subset3())
```


### View overall filtered table

```{r}
renderDataTable(filtered())
```
